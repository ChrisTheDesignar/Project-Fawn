---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('posts'))
  .filter((p) => !p.data.draft)
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<BaseLayout title="Home">
  <style>
    h1 { margin: 0 0 6px 0; color: var(--accent); font-size: 1.1rem; }
    p.subhead { margin: 0 0 14px 0; color: #ccc; font-size: .95rem; }

    section.posts { margin-top: 16px; }
    .post-preview {
      display: flex; gap: 14px; padding: 12px 0;
      border-top: 1px solid var(--border);
      align-items: flex-start;
      text-decoration: none; color: inherit;
    }
    .post-preview:hover {
      background: color-mix(in srgb, var(--fg), transparent 92%);
    }

    .post-thumb {
      width: clamp(140px, 20vw, 220px);
      aspect-ratio: 16/9;
      height: auto;
      object-fit: cover;
      display: block;
      border: 1px solid var(--border);
    }

    .post-meta { flex: 1; }
    .post-title { font-weight: 700; margin: 0; line-height: 1.2; }
    .post-date { font-size: .75rem; color: var(--muted); margin-top: 2px; display: block; }
    .post-desc { margin: 8px 0 0; color: #ccc; font-size: .9rem; }
  </style>

  <section>
    <h1>Welcome to Project Fawn</h1>
    <p class="subhead">fully custom open-sourced 3D printed ski boots</p>
  </section>

  <section class="posts">
    <h2 style="font-size:.95rem; margin: 0 0 10px 0;">Recent Posts</h2>

    {posts.map((post) => (
      <a class="post-preview" href={`/post/${post.slug}/`}>
        {post.data.cover && (
          <img
            class="post-thumb"
            src={post.data.cover.src}
            alt={post.data.coverAlt ?? post.data.title}
            loading="lazy"
          />
        )}
        <div class="post-meta">
          <h3 class="post-title">{post.data.title}</h3>
          <time class="post-date" datetime={post.data.pubDate.toISOString()}>
            {post.data.pubDate.toLocaleDateString()}
          </time>
          {post.data.description && <p class="post-desc">{post.data.description}</p>}
        </div>
      </a>
    ))}
  </section>
</BaseLayout>
