---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection, getEntryBySlug } from 'astro:content';

export async function getStaticPaths() {
  const all = await getCollection('posts');
  return all
    .filter(({ data }) => !data.draft)
    .map((post) => ({ params: { slug: post.slug } }));
}

const { slug } = Astro.params;
const post = await getEntryBySlug('posts', slug);
if (!post) throw new Error('Post not found');
const { Content } = await post.render();
---

<BaseLayout title={post.data.title}>
  {post.data.image && (
    <img class="hero" src={post.data.image} alt={post.data.title} />
  )}

  <h1 class="title">{post.data.title}</h1>
  <time class="date">{post.data.date}</time>

  <article class="prose">
    <Content />
  </article>

  <style>
    .hero{ width:100%; height:auto; display:block; margin:0 auto 12px; }
    .title{ margin:6px 0 0; color:#a8ffb0; font-size:1.35rem; }
    .date{ display:block; color:#bbb; font-size:.85rem; margin-bottom:10px; }
    /* reasonable reading width + nice paragraph color/line-height */
    .prose :global(p){ line-height:1.6; color:#ddd; }
  </style>
</BaseLayout>
