---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection, getEntryBySlug } from 'astro:content';

export async function getStaticPaths() {
  const all = await getCollection('posts');
  return all.map((post) => ({ params: { slug: post.slug } }));
}

const { slug } = Astro.params;
const post = await getEntryBySlug('posts', slug);
if (!post) throw new Error(`Post not found: ${slug}`);

const { Content } = await post.render();

const formatDate = (d: Date) =>
  d.toLocaleDateString(undefined, {
    year: 'numeric',
    month: 'short',
    day: 'numeric',
    timeZone: 'UTC',
  });
---

<BaseLayout title={post.data.title}>
  {post.data.cover && (
    <img
      src={post.data.cover.src}
      alt={post.data.coverAlt ?? post.data.title}
      style="display:block; width:100%; margin: 0 auto 1rem; aspect-ratio: 16/9; object-fit: cover; border:1px solid var(--border);"
      loading="eager"
    />
  )}

  <h1 style="margin:0 0 .25rem 0;">{post.data.title}</h1>
  <time datetime={post.data.pubDate.toISOString()} class="post-date">
    {formatDate(post.data.pubDate)}
  </time>

  <!-- Let BaseLayout's ARTICLE styles handle width/typography -->
  <div style="margin-top:1rem; line-height:1.6;">
    <Content />
  </div>
</BaseLayout>